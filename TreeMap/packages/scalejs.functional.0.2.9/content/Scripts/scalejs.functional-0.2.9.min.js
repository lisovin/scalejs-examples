define("scalejs.functional/functional",[],function(){function t(){var e=Array.prototype.slice.call(arguments,0).reverse();return function(){var t=e.reduce(function(e,t){return[t.apply(undefined,e)]},Array.prototype.slice.call(arguments));return t[0]}}function n(){var e=Array.prototype.slice.call(arguments,0);return function(){var t=e.reduce(function(e,t){return[t.apply(undefined,e)]},Array.prototype.slice.call(arguments,0));return t[0]}}function r(e,t){var n=Array.prototype.slice.call(arguments,2);return function(){return t.apply(e,n.concat(Array.prototype.slice.call(arguments,0)))}}function i(e,t){return function(){return e.apply(undefined,Array.prototype.slice.call(arguments,0,t))}}function s(e,t){if(arguments.length===1)return s(e,e.length);var n=Array.prototype.slice.call(arguments,2);return n.length>=t?e.apply(undefined,n):function(){var r=n.concat(Array.prototype.slice.call(arguments,0));return r.unshift(e,t),s.apply(undefined,r)}}function o(){var t=Array.prototype.slice.call(arguments,0),n=t.reduce(function(t,n,r){return n===e?t.concat([r]):t},[]);return n.length===0?t[0].apply(undefined,t.slice(1)):function(){var e;for(e=0;e<Math.min(n.length,arguments.length);e+=1)t[n[e]]=arguments[e];return o.apply(undefined,t)}}var e={};return{_:e,compose:t,sequence:n,bind:r,aritize:i,curry:s,partial:o}}),define("scalejs.functional/builder",["scalejs!core"],function(e){function i(e){function s(e,t){if(!t||t.kind!=="$")return typeof t=="function"?t.bind(e):t;if(typeof t.expr=="function")return t.expr.call(e);if(typeof t.expr=="string")return e[t.expr];throw new Error("Parameter in $(...) must be either a function or a string referencing a binding.")}function o(o,u,a,f){function l(e){return e==="$return"||e==="$RETURN"||e==="$yield"||e==="$YIELD"}if(typeof e[o]!="function"&&o!=="$then"&&o!=="$else")throw new Error("This control construct may only be used if the computation expression builder defines a `"+o+"` method.");var c=s(u,a),h,p;if(f.length>0&&typeof e.combine!="function")throw new Error("This control construct may only be used if the computation expression builder defines a `combine` method.");if(l(o)){if(f.length===0)return e[o](c);if(typeof e.delay!="function")throw new Error("This control construct may only be used if the computation expression builder defines a `delay` method.");return e.combine(e[o](c),e.delay(function(){return i(u,f)}))}if(o==="$for")return e.combine(e.$for(a.items,function(e){var n=r.copy(a.cexpr),s=t(u);return s[a.name]=e,i(s,n)}),i(u,f));if(o==="$while"){if(typeof e.delay!="function")throw new Error("This control construct may only be used if the computation expression builder defines a `delay` method.");return c=e.$while(a.condition.bind(u),e.delay(function(){var e=n(u),t=r.copy(a.cexpr);return i(e,t)})),f.length>0?e.combine(c,i(u,f)):c}return o==="$then"||o==="$else"?(h=n(u),p=r.copy(a.cexpr),e.combine(i(h,p),f)):e.combine(e[o](c),i(u,f))}var i;return e.missing||(e.missing=function(e){throw e.kind?new Error('Unknown operation "'+e.kind+'". '+"Either define `missing` method on the builder or fix the spelling of the operation."):new Error("Expression "+JSON.stringify(e)+" cannot be processed. "+"Either define `missing` method on the builder or convert expression to a function.")}),i=function(t,n){var r;if(n.length===0){if(e.zero)return e.zero();throw new Error("Computation expression builder must define `zero` method.")}r=n.shift();if(r.kind==="let")return t[r.name]=s(t,r.expr),i(t,n);if(r.kind==="do")return r.expr.call(t),i(t,n);if(r.kind==="letBind")return e.bind(s(t,r.expr),function(e){return t[r.name]=e,i(t,n)});if(r.kind==="doBind"||r.kind==="$"){if(n.length>0)return e.bind(s(t,r.expr),function(){return i(t,n)});if(typeof e.$return!="function")throw new Error("This control construct may only be used if the computation expression builder defines a `$return` method.");return e.bind(s(t,r.expr),function(){return e.$return()})}return r.kind==="$return"||r.kind==="$RETURN"||r.kind==="$yield"||r.kind==="$YIELD"?o(r.kind,t,r.expr,n):r.kind==="$for"||r.kind==="$while"?o(r.kind,t,r,n):r.kind==="$if"?r.condition.call(t)?o("$then",t,r.thenExpr,n):r.elseExpr?o("$else",t,r.elseExpr,n):o(i(t,[]),n):typeof r=="function"&&e.call?(e.call(t,r),i(t,n)):typeof r=="function"?(r.call(t,r),i(t,n)):o("missing",t,r,n)},function(){function s(){var e={mixins:Array.prototype.slice.call(arguments,0)},t=n.bind(e);return t.mixin=function(){return Array.prototype.push.apply(e.mixins,arguments),t},t}var t=r.copy(arguments),n=function(){var n=Array.prototype.slice.call(arguments,0),r=this||{},s,o;return this.mixins&&this.mixins.forEach(function(e){e.beforeBuild&&e.beforeBuild(r,n)}),e.delay?o=e.delay(function(){return i(r,n)}):o=i(r,n),e.run?s=e.run.apply(null,[o].concat(t)):s=o,this.mixins&&this.mixins.forEach(function(e){e.afterBuild&&(s=e.afterBuild(s))}),s};return n.mixin=s,n}}var t=e.object.merge,n=e.object.clone,r=e.array;return i.$let=function(e,t){return{kind:"let",name:e,expr:t}},i.$LET=function(e,t){return{kind:"letBind",name:e,expr:t}},i.$do=function(e){return{kind:"do",expr:e}},i.$DO=function(e){return{kind:"doBind",expr:e}},i.$return=function(e){return{kind:"$return",expr:e}},i.$RETURN=function(e){return{kind:"$RETURN",expr:e}},i.$yield=function(e){return{kind:"$yield",expr:e}},i.$YIELD=function(e){return{kind:"$YIELD",expr:e}},i.$for=function(e,t){var n=Array.prototype.slice.call(arguments,2);return{kind:"$for",name:e,items:t,cexpr:n}},i.$while=function(e){if(arguments.length<2)throw new Error('Incomplete `while`. Expected "$while(<condition>, <expr>)".');var t=Array.prototype.slice.call(arguments,1);return{kind:"$while",condition:e,cexpr:t}},i.$if=function(e,t,n){if(arguments.length<2)throw new Error('Incomplete conditional. Expected "$if(<expr>, $then(expr))" or "$if(<expr>, $then(<expr>), $else(<expr>)"');if(typeof e!="function")throw new Error("First argument must be a function that defines the condition of $if.");if(t.kind!=="$then")throw new Error('Unexpected "'+t.kind+'" in the place of "$then"');if(n&&n.kind!=="$else")throw new Error('Unexpected "'+n.kind+'" in the place of "$else"');return{kind:"$if",condition:e,thenExpr:t,elseExpr:n}},i.$then=function(){var e=Array.prototype.slice.call(arguments,0);if(e.length===0)throw new Error("$then should contain at least one expression.");return{kind:"$then",cexpr:e}},i.$else=function(){var e=Array.prototype.slice.call(arguments,0);if(e.length===0)throw new Error("$else should contain at least one expression.");return{kind:"$else",cexpr:e}},i.$=function(e){return{kind:"$",expr:e}},i}),define("scalejs.functional/completeBuilder",["./builder"],function(e){var t=e({bind:function(e,t){return function(n){return e(function(e){var r=t(e);r(n)})}},$return:function(e){return function(t){t&&t(e)}}});return t()}),define("scalejs.functional",["scalejs!core","./scalejs.functional/functional","./scalejs.functional/builder","./scalejs.functional/completeBuilder"],function(e,t,n,r){var i=e.object.merge;e.registerExtension({functional:i(t,{builder:n,builders:{complete:r}})})});