//knockout-classBindingProvider v0.4.0 | (c) 2012 Ryan Niemeyer | http://www.opensource.org/licenses/mit-license

define("scalejs.mvvm/classBindingProvider",["knockout"],function(e){return function(n){function a(e){var t,n;return i[e]?i[e]:(t=e.split("."),n=t.reduce(function(e,t){return e[t]},i),n)}function f(t){e.utils.extend(i,t)}function l(e){var t,i;return e.nodeType===1?t=e.getAttribute(o):e.nodeType===8&&(i=(e.nodeValue||e.text||"").toString(),t=i.indexOf(u)>-1),!t&&n.fallback&&(t=r.nodeHasBindings(e)),t}function c(t,i){var a,f,l,c={},h,p,d="";t.nodeType===1?d=t.getAttribute(o):t.nodeType===8&&(h=(t.nodeValue||t.text||"").toString(),p=h.indexOf(u),p>-1&&(d=h.substring(p+u.length))),d?(d=d.replace(/^(\s|\u00A0)+|(\s|\u00A0)+$/g,"").replace(/(\s|\u00A0){2,}/g," ").split(" "),d.forEach(function(t){a=s(t),a&&(f=typeof a=="function"?a.call(i.$data,i,d):a,e.utils.extend(c,f))})):n.fallback&&(c=r.getBindings(t,i));for(l in c)c.hasOwnProperty(l)&&l!=="_ko_property_writers"&&!e.bindingHandlers[l]&&n.log&&(f?n.log('Unknown binding handler "'+l+'" found in',t,'defined in data-class "'+d+'" as',f,"Make sure that binding handler's name spelled correctly and that it's properly registered. The binding will be ignored."):n.log('Unknown binding handler "'+l+'" in',t,"Make sure that it's name spelled correctly and that it's properly registered. The binding will be ignored."));return c}var r=new e.bindingProvider,i={},s,o,u;return n=n||{},o=n.attribute||"data-class",u="ko "+(n.virtualAttribute||"class")+":",s=n.bindingRouter||a,{registerBindings:f,getBindings:c,nodeHasBindings:l,bindingRouter:s}}}),define("scalejs.mvvm/htmlTemplateSource",["knockout","scalejs!core"],function(e,t){function o(e){var t=document.createElement("div");t.innerHTML=e,n(t.childNodes).forEach(function(e){e.nodeType===1&&r(e,"id")&&(s[e.id]=e.innerHTML)})}function u(e){function t(t,n){r(s.data,e)||(s.data[e]={});if(arguments.length===1)return s.data[e][t];s.data[e][t]=n}function n(t){if(arguments.length===0)return s[e];throw new Error('An attempt to override template "'+e+'" with content "'+t+'" '+"Template overriding is not supported.")}return{data:t,text:n}}var n=t.array.toArray,r=t.object.has,i=new e.nativeTemplateEngine,s={data:{}};return i.makeTemplateSource=u,e.setTemplateEngine(i),{registerTemplates:o}}),define("scalejs.mvvm/selectableArray",["knockout","scalejs!core"],function(e,t){var n=e.isObservable,r=e.utils.unwrapObservable,i=e.observable,s=e.computed,o=t.object.has,u=t.array;return function(t,a){function h(e){if(n(e.isSelected)&&(!o(a.isSelectedPath)||a.isSelectedPath==="isSelected"))return;if(n(e.isSelected))throw new Error('item has observable `isSelected` property but `isSelectedPath` specified as "'+a.isSelectedPath+'". `selectable` uses `isSelected` property of an item '+"to determine whether it's selected. Either don't specify `isSelectedPath` or "+"rename `isSelected` property to something else.");if(e.hasOwnProperty("isSelected"))throw new Error("item has non-observable `isSelected` property. `selectable` uses `isSelected` property of an item to determine whether it's selected. Either make `isSelected` observable or rename it.");e.isSelected=i();if(o(a.isSelectedPath)&&a.isSelectedPath!=="isSelected"&&!n(e[a.isSelectedPath]))throw new Error("item's property \""+a.isSelectedPath+'" specified by `isSelectedPath` '+" isn't observable. Either make it observable or specify different property in "+" `isSelectedPath`");o(a.isSelectedPath)&&(e.isSelected=e[a.isSelectedPath]),e.isSelected.subscribe(function(t){t?f(e):f()===e&&f(undefined)})}a=a||{};var f=a.selectedItem||i(),l=a.selectionPolicy||"single",c;return n(t)?c=s(function(){var e=r(t);return e.forEach(h),u.copy(e)}):(t.forEach(h),c=u.copy(t)),f.subscribe(function(e){r(c).forEach(function(t){t.isSelected(t===e)}),l==="deselect"&&e&&setTimeout(function(){f(undefined)},0)}),c.selectedItem=f,c}}),define("scalejs.mvvm/ko.utils",["knockout"],function(e){function t(t,n){return t.map(function(t){var r=t.cloneNode(!0);return n?e.cleanNode(r):r})}return{cloneNodes:t}}),define("scalejs.mvvm/mvvm",["knockout","knockout.mapping","scalejs!core","./classBindingProvider","./htmlTemplateSource","./selectableArray","./ko.utils"],function(e,t,n,r,i,s,o){function h(t){return e.observable(t)}function p(t){return e.observableArray(t)}function d(t){return e.computed(t)}function v(e){return t.toJSON(e)}function m(e){l.registerBindings(e)}function g(e,n,r){var i=Object.keys(r).reduce(function(e,t){return u(e,{k:t,create:function(e){return r[t](e.data)}})},{});return t.fromJS(e,i,n)}function y(){a(arguments).forEach(i.registerTemplates)}function b(e,t){return f(e,"string")?{dataClass:e,viewmodel:t}:f(e,"function")?e.bind(t):e}function w(){var t=document.getElementsByTagName("body")[0];t.innerHTML="<!-- ko class: scalejs-shell --><!-- /ko -->",m({"scalejs-shell":function(e){return{render:e.$data.root}}}),e.applyBindings({root:c})}var u=n.object.merge,a=n.array.toArray,f=n.type.is,l=r({log:n.log.warn,fallback:!0}),c=e.observable();return e.bindingProvider.instance=l,{core:{mvvm:{toJson:v,registerBindings:m,registerTemplates:y,renderable:b,selectableArray:s,ko:{utils:o}}},sandbox:{mvvm:{observable:h,observableArray:p,computed:d,registerBindings:m,registerTemplates:y,toJson:v,toViewModel:g,renderable:b,selectableArray:s,root:c}},init:w}}),define("scalejs.bindings/change",["knockout","scalejs!core"],function(e,t){function i(t,i,s,o){function p(e,n){return function(r){r!==n&&(n=r,e.call(o,r,t))}}function d(n,r){e.computed({read:function(){var e=u(o[n]);r(e)},disposeWhenNodeIsRemoved:t})}if(!r(o))return;var u=e.utils.unwrapObservable,a=i(),f=u(a),l,c,h;for(l in f)f.hasOwnProperty(l)&&(c=f[l],n(c.initial,"function")&&c.initial.apply(o,[u(o[l]),t]),n(c.update,"function")&&(h=p(c.update,u(o[l]))),n(c,"function")&&(h=p(c,u(o[l]))),h&&d(l,h))}var n=t.type.is,r=t.object.has;return{init:i}}),define("scalejs.bindings/render",["scalejs!core","knockout"],function(e,t){function i(){return{controlsDescendantBindings:!0}}function s(e,i,s,o,u){var a=r(i()),f,l,c;if(!a)return;if(n(a.dataClass,"string")){f=t.bindingProvider.instance.bindingRouter(a.dataClass);if(!f)throw new Error("Don't know how to render binding \""+a.dataClass+'" - no such binding registered. '+"Either register the bindng or correct its name.");f&&(l=n(f,"function")?f.call(a.viewmodel||o,u):f)}else l=n(a,"function")?a.call(o,u):a;return c=t.applyBindingsToNode(e,l),n(l,"afterRender","function")&&l.afterRender(e),n(a,"afterRender","function")&&a.afterRender(e),c}var n=e.type.is,r=t.utils.unwrapObservable;return{init:i,update:s}}),define("scalejs.bindings/transitionable",["scalejs!core","knockout","../scalejs.mvvm/ko.utils","scalejs.statechart-scion"],function(e,t,n){function c(e,n,c){function m(e){u(p)&&setTimeout(function(){p(e)},0)}function g(){t.virtualElements.setDomNodeChildren(e,l(d)),t.applyBindingsToDescendants(n,e)}function y(){d=l(t.virtualElements.childNodes(e),!0),t.virtualElements.emptyNode(e)}function b(r){var i=r.shift(),s=t.virtualElements.childNodes(e).filter(function(e){return e.nodeType===1})[0];i&&setTimeout(function(){var e={element:s,viewModel:n,renderChild:g};i.call(e,function(){h.send("transition.finished",{transition:i})})},0)}function w(){y(),f({read:function(){var e=a(p);e&&setTimeout(function(){h.send(e)},0)},disposeWhenNodeIsRemoved:e}),h.start()}var h,p=c.transitionableState,d,v;return v=i({inTransitions:[],outTransitions:[]},c),h=s(o("in.started").onEntry(function(){this.transitions=r.copy(v.inTransitions)}).on(function(){return this.transitions.length>0}).goto("in.transitioning").goto("in.finished"),o("in.transitioning").onEntry(function(){b(this.transitions)}).on("transition.finished",function(){return this.transitions.length>0}).goto("in.transitioning").on("transition.finished").goto("in.finished"),o("in.finished").onEntry(function(){m("in.finished")}).on("out.started").goto("out.started"),o("out.started").onEntry(function(){this.transitions=r.copy(v.outTransitions)}).on(function(){return this.transitions.length>0}).goto("out.transitioning").goto("out.finished"),o("out.transitioning").onEntry(function(){b(this.transitions)}).on("transition.finished",function(){return this.transitions.length>0}).goto("out.transitioning").on("transition.finished").goto("out.finished"),o("out.finished").onEntry(function(){m("out.finished")}).on("in.transitioning").goto("in.started")),{start:w}}function h(e,t,n,r,i){return{controlsDescendantBindings:!0}}function p(e,t,n,r,i){var s=t(),o=c(e,r,s);o.start()}var r=e.array,i=e.object.merge,s=e.state.builder.builder({logStatesEnteredAndExited:!1}),o=e.state.builder.state,u=t.isObservable,a=t.utils.unwrapObservable,f=t.computed,l=n.cloneNodes;return{init:h,update:p}}),define("scalejs.mvvm",["scalejs!core","knockout","./scalejs.mvvm/mvvm","./scalejs.bindings/change","./scalejs.bindings/render","./scalejs.bindings/transitionable"],function(e,t,n,r,i,s){t.bindingHandlers.change=r,t.bindingHandlers.render=i,t.bindingHandlers.transitionable=s,t.virtualElements.allowedBindings.change=!0,t.virtualElements.allowedBindings.render=!0,t.virtualElements.allowedBindings.transitionable=!0,n.init(),e.registerExtension(n)});