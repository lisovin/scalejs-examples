define("scalejs.statechart-scion/state.builder",["scalejs!core","scion"],function(e,t){return function(n){function v(e){return f(function(t){if(t.onEntry)throw new Error("Only one `onEntry` action is allowed.");if(typeof e!="function")throw new Error("`onEntry` takes a function as a parameter.");return t.onEntry=e,t})}function m(e){return f(function(t){if(t.onExit)throw new Error("Only one `onExit` action is allowed.");if(typeof e!="function")throw new Error("`onExit` takes a function as a parameter.");return t.onExit=e,t})}function g(e){return f(function(t){t.event=e})}function y(e){return f(function(t){t.cond=e})}function b(e,t,n){return f(function(i){if(o(i)==="state")return d(b(e,t,n))(i);e&&(i.type="internal"),typeof t=="function"?i.onTransition=t:(i.target=s(t,"array")?t:t.split(" "),n&&(i.onTransition=n))})}function w(e,t){return b(!1,e,t)}function E(e,t){return b(!0,e,t)}function S(e){if(typeof e=="function")return f(function(t){t.onTransition=e});if(e.kind==="$yield")return e;throw new Error("Unsupported transition action",e)}function x(){var e=r.copy(arguments),t=e.pop(),n;if(e.length>2)throw new Error("First (optional) argument should be event name, second (optional) argument should be a condition function");if(typeof t!="function"&&t.kind!=="$yield")throw new Error("Last argument should be either `goto` or a function.");return n=e.map(function(e){if(typeof e=="string")return g(e);if(typeof e=="function")return y(e);throw new Error("Transition argument ",e," is not supported. First (optional) argument should be event name, second (optional) argument should be a condition function")}),f(d.apply(null,n.concat([S(t)])))}function T(){var e=r.copy(arguments),t=e.pop();e.forEach(function(e){if(typeof e!="string")throw new Error("`whenInStates` accepts list of states and either `goto` or a function as the last argument.")});if(typeof t!="function"&&t.kind!=="$yield")throw new Error("Last argument should be either `goto` or a function.");return f(d(y(function(t,n){return e.every(function(e){return n(e)})}),t))}function N(){var e=r.copy(arguments),t=e.pop();e.forEach(function(e){if(typeof e!="string")throw new Error("`whenNotInStates` accepts list of states and either `goto` or a function as the last argument.")});if(typeof t!="function"&&t.kind!=="$yield")throw new Error("Last argument should be either `goto` or a function.");return f(d(y(function(t,n){return e.every(function(e){return!n(e)})}),t))}function C(e){return f(function(t){if(t.parallel)return new Error("`initial` shouldn't be specified on parallel region.");t.initial=e})}function k(n){return function(){var i=h.apply(null,arguments);return new t.Statechart(i,u({log:e.log.debug},n))}}var r=e.array,i=e.object.has,s=e.type.is,o=e.type.typeOf,u=e.object.merge,a=e.functional.builder,f=a.$yield,l,c,h,p,d;return l=a({run:function(e,t){var n=new function(){};return i(t,"parallel")&&(n.type="parallel"),e(n),n},delay:function(e){return e()},zero:function(){return function(){}},$yield:function(e){return e},combine:function(e,t){return function(n){e(n),t(n)}},missing:function(e){if(typeof e=="string")return function(t){if(t.id)throw new Error("Can't set state id to \""+e+'". '+"state's id is already set to \""+t.id+'"');t.id=e};if(typeof e=="function")return e;if(o(e)==="state")return function(t){t.states||(t.states=[]),t.states.push(e)};throw new Error("Missing builder for expression: "+JSON.stringify(e))}}),h=l(),p=l({parallel:!0}),c=a({run:function(e){return function(t){t.transitions||(t.transitions=[]);var n={};e(n),t.transitions.push(n)}},delay:function(e){return e()},zero:function(){return function(){}},$yield:function(e){return e},combine:function(e,t){return function(n){e(n),t(n)}},missing:function(e){if(typeof e=="function")return e;throw new Error('Unknown operation "'+e.kind+'" in transition expression',e)}}),d=c(),{builder:k,state:h,parallel:p,initial:C,onEntry:v,onExit:m,on:x,whenInStates:T,whenNotInStates:N,"goto":w,gotoInternally:E,statechart:k({logStatesEnteredAndExited:n.logStatesEnteredAndExited,log:e.log.debug})}}}),define("scalejs.statechart-scion/state",["scalejs!core","./state.builder","scion","scalejs.functional"],function(e,t,n){return function(r){function v(e){return u(e,"states")?i.make(e).concat(i.from(e.states).selectMany(v)):i.make(e)}function m(e,t){var n=v(e).firstOrDefault(function(e){return e.id===t});return n}function g(e,t){var n=v(e).firstOrDefault(function(e){return e.states&&e.states.some(function(e){return e.id===t})});return n}function y(){return f(function(e,t){var n,r;n=m(p,e);if(!n)throw new Error('Parent state "'+e+"\" doesn't exist");if(u(t,"id")){r=m(p,t.id);if(r)throw new Error('State "'+t.id+'" already exists.')}u(n,"states")||(n.states=[]),n.states.push(t)}).apply(null,arguments)}function b(t){if(e.isApplicationRunning())throw new Error("Can't register a state while application is running.");s(arguments,1).forEach(y(t))}function w(){if(e.isApplicationRunning())throw new Error("Can't unregister a state while application is running.");s(arguments).forEach(function(e){var t=g(p,e),n=i.from(t.states).first(function(t){return t.id===e});o(t.states,n)})}function E(e,t,n){var r;if(a(e,"string"))r={name:e};else{if(!a(e,"name"))throw new Error("event object should have `name` property.");r=e}!u(n)&&a(t,"number")?n=t:r.data=t,d.send(r,{delay:n})}function S(){return e.reactive.Observable.create(function(e){var t={onEntry:function(t){e.onNext({event:"entry",state:t})},onExit:function(t){e.onNext({event:"exit",state:t})},onTransition:function(t,n){e.onNext({event:"transition",source:t,targets:n})}};return d.registerListener(t),function(){d.unregisterListener(t)}})}function x(e){return function(t){S().where(function(t){return t.event==="entry"&&t.state===e}).take(1).subscribe(function(){t()})}}var i=e.linq.enumerable,s=e.array.toArray,o=e.array.removeOne,u=e.object.has,a=e.type.is,f=e.functional.curry,l=t(r),c=l.state,h=l.parallel,p,d;return p=c("scalejs-app",h("root")),e.onApplicationEvent(function(t){switch(t){case"started":d=new n.Statechart(p,{logStatesEnteredAndExited:r.logStatesEnteredAndExited,log:e.log.debug}),d.start();break;case"stopped":}}),{registerStates:b,unregisterStates:w,raise:E,observe:S,onState:x,builder:l}}}),define("scalejs.statechart-scion",["scalejs!core","./scalejs.statechart-scion/state","module"],function(e,t,n){e.registerExtension({state:t(n.config())})});