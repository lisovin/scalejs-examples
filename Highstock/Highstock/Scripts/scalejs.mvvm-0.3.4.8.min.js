// knockout-classBindingProvider 0.5.0 | (c) 2013 Ryan Niemeyer |  http://www.opensource.org/licenses/mit-license

!function(e){"function"==typeof define&&define.amd?define("scalejs.mvvm/classBindingProvider",["knockout","exports"],e):e(ko)}(function(e,n){var t=function(e,n){var t,i;if(!e)return e;t={};for(i in e)e.hasOwnProperty(i)&&(t[i]=n(e[i],i,e));return t},i=function(e){return function(){return e}};e.version>="3.0.0"&&!function(){var n=document.createElement("div");e.applyBindings(null,n);var t=e.contextFor(n),i=!e.storedBindingContextForNode,r=i?"A":"_subscribable",a=i?"wb":"_addNode",s=function(){};s[a]=s,t.constructor.prototype[r]=s,e.cleanNode(n)}();var r=function(n,r){var a=new e.bindingProvider;r=r||{},this.attribute=r.attribute||"data-class",this.virtualAttribute="ko "+(r.virtualAttribute||"class")+":",this.fallback=r.fallback,this.bindings=n||{},this.bindingRouter=r.bindingRouter||function(e,n){var t,i,r,a;if(n[e])return n[e];for(r=e.split("."),a=n,t=0,i=r.length;i>t;t++)a=a[r[t]];return a},this.registerBindings=function(n){e.utils.extend(this.bindings,n)},this.nodeHasBindings=function(e){var n,t;return 1===e.nodeType?n=e.getAttribute(this.attribute):8===e.nodeType&&(t=""+e.nodeValue||e.text,n=t.indexOf(this.virtualAttribute)>-1),!n&&this.fallback&&(n=a.nodeHasBindings(e)),n},this.getBindingsFunction=function(n){return function(s,o){var c,d,l,u,f,g,m={},b="";if(1===s.nodeType?b=s.getAttribute(this.attribute):8===s.nodeType&&(f=""+s.nodeValue||s.text,g=f.indexOf(this.virtualAttribute),g>-1&&(b=f.substring(g+this.virtualAttribute.length))),b)for(b=b.replace(/^(\s|\u00A0)+|(\s|\u00A0)+$/g,"").replace(/(\s|\u00A0){2,}/g," ").split(" "),c=0,d=b.length;d>c;c++)l=this.bindingRouter(b[c],this.bindings),l?(u="function"==typeof l?l.call(o.$data,o,b):l,n&&(u=t(u,i)),e.utils.extend(m,u)):r.log&&r.log('No binding function provided for data class "'+b[c]+'" in element ',s,"\nMake sure data class is spelled correctly and that it's binding function is registered.");else this.fallback&&(m=a[n?"getBindingAccessors":"getBindings"](s,o));if(r.log)for(bindingName in m)m.hasOwnProperty(bindingName)&&"_ko_property_writers"!==bindingName&&"valueUpdate"!==bindingName&&"optionsText"!==bindingName&&!e.bindingHandlers[bindingName]&&(u?r.log('Unknown binding handler "'+bindingName+'" found in element',s,' defined in data-class "'+b+'" as',u,"\nMake sure that binding handler's name is spelled correctly and that it's properly registered. \nThe binding will be ignored."):r.log('Unknown binding handler "'+bindingName+'" in',s,"\nMake sure that it's name spelled correctly and that it's properly registered. \nThe binding will be ignored."));return m}},this.getBindings=this.getBindingsFunction(!1),this.getBindingAccessors=this.getBindingsFunction(!0)};return n||(e.classBindingProvider=r),r}),define("scalejs.mvvm/htmlTemplateSource",["knockout","scalejs!core"],function(e,n){function t(e){var n=document.createElement("div");"undefined"!=typeof WinJS?WinJS.Utilities.setInnerHTMLUnsafe(n,e):n.innerHTML=e,r(n.childNodes).forEach(function(e){1===e.nodeType&&a(e,"id")&&(o[e.id]=e.innerHTML)})}function i(e){function n(n,t){return a(o.data,e)||(o.data[e]={}),1===arguments.length?o.data[e][n]:void(o.data[e][n]=t)}function t(n){if(0===arguments.length)return o[e];throw new Error('An attempt to override template "'+e+'" with content "'+n+'" Template overriding is not supported.')}return{data:n,text:t}}var r=n.array.toArray,a=n.object.has,s=new e.nativeTemplateEngine,o={data:{}};return s.makeTemplateSource=i,e.setTemplateEngine(s),{registerTemplates:t}}),define("scalejs.mvvm/selectableArray",["knockout","scalejs!core"],function(e,n){var t=e.isObservable,i=e.utils.unwrapObservable,r=e.observable,a=e.computed,s=n.object.has,o=n.array;return function(e,n){function c(e){if(!t(e.isSelected)||s(n.isSelectedPath)&&"isSelected"!==n.isSelectedPath){if(t(e.isSelected))throw new Error('item has observable `isSelected` property but `isSelectedPath` specified as "'+n.isSelectedPath+"\". `selectable` uses `isSelected` property of an item to determine whether it's selected. Either don't specify `isSelectedPath` or rename `isSelected` property to something else.");if(e.hasOwnProperty("isSelected"))throw new Error("item has non-observable `isSelected` property. `selectable` uses `isSelected` property of an item to determine whether it's selected. Either make `isSelected` observable or rename it.");if(e.isSelected=r(),s(n.isSelectedPath)&&"isSelected"!==n.isSelectedPath&&!t(e[n.isSelectedPath]))throw new Error("item's property \""+n.isSelectedPath+"\" specified by `isSelectedPath`  isn't observable. Either make it observable or specify different property in  `isSelectedPath`");s(n.isSelectedPath)&&(e.isSelected=e[n.isSelectedPath]),e.isSelected.subscribe(function(n){n?l(e):l()===e&&l(void 0)})}}n=n||{};var d,l=n.selectedItem||r(),u=n.selectionPolicy||"single";return t(e)?d=a(function(){var n=i(e);return n.forEach(c),o.copy(n)}):(e.forEach(c),d=o.copy(e)),l.subscribe(function(e){i(d).forEach(function(n){n.isSelected(n===e)}),"deselect"===u&&e&&setTimeout(function(){l(void 0)},0)}),d.selectedItem=l,d}}),define("scalejs.mvvm/ko.utils",["scalejs!core","knockout"],function(e,n){function t(t,i){return e.array.toArray(t).map(function(e){var t=e.cloneNode(!0);return i?n.cleanNode(t):t})}return{cloneNodes:t}}),define("scalejs.mvvm/mvvm",["knockout","knockout.mapping","scalejs!core","scalejs.mvvm/classBindingProvider","./htmlTemplateSource","./selectableArray","./ko.utils"],function(e,n,t,i,r,a,s){function o(n){return e.observable(n)}function c(n){return e.observableArray(n)}function d(n){return e.computed(n)}function l(e){return n.toJSON(e)}function u(e){return JSON.parse(l(e))}function f(){w(arguments).forEach(S.registerBindings.bind(S))}function g(e,t,i){var r=Object.keys(i).reduce(function(e,n){return k(e,{k:n,create:function(e){return i[n](e.data)}})},{});return n.fromJS(e,r,t)}function m(){w(arguments).forEach(r.registerTemplates)}function b(e,n){var t={};return t[e]=n,t}function p(e,n){return b("template",{name:e,data:n})}function h(e,n){return{dataClass:e,viewmodel:n}}function v(e){return document.getElementsByTagName(e)[0]}function y(){var n,t=document.createComment(" ko class: scalejs-shell "),i=document.createComment(" /ko ");n=document.getElementsByTagName("script"),n=n[n.length-1].parentElement,n||Array.prototype.slice.call(document.getElementsByTagName("script")).forEach(function(e){"app/app"===e.getAttribute("data-main")&&(n=e.parent)}),(n===v("html")||n===v("head"))&&(n=v("body")),n&&(n.appendChild(t),n.appendChild(i),f({"scalejs-shell":function(e){return{render:e.$data.root}}}),e.applyBindings({root:T},n))}var k=t.object.merge,w=t.array.toArray,S=new i({},{log:t.log.warn,fallback:!0}),T=e.observable();return e.bindingProvider.instance=S,{core:{mvvm:{toJson:l,registerBindings:f,registerTemplates:m,dataClass:h,template:p,dataBinding:b,selectableArray:a,ko:{utils:s}}},sandbox:{mvvm:{observable:o,observableArray:c,computed:d,registerBindings:f,registerTemplates:m,toJson:l,toViewModel:g,toObject:u,dataClass:h,template:p,dataBinding:b,selectableArray:a,root:T}},init:y}}),define("scalejs.bindings/change",["knockout","scalejs!core"],function(e,n){function t(n,t,a,s){function o(e,t){return function(i){i!==t&&(t=i,e.call(s,i,n))}}function c(t,i){e.computed({read:function(){var e=f(s[t]);i(e)},disposeWhenNodeIsRemoved:n})}if(r(s)){var d,l,u,f=e.utils.unwrapObservable,g=t(),m=f(g);for(d in m)m.hasOwnProperty(d)&&(l=m[d],i(l.initial,"function")&&l.initial.apply(s,[f(s[d]),n]),i(l.update,"function")&&(u=o(l.update,f(s[d]))),i(l,"function")&&(u=o(l,f(s[d]))),u&&c(d,u))}}var i=n.type.is,r=n.object.has;return{init:t}}),define("scalejs.bindings/render",["scalejs!core","knockout","scalejs.functional"],function(e,n){function t(){return{controlsDescendantBindings:!0}}function i(e,t,i,d,l){function u(t){g?n.applyBindingsToNode(e,g,d):n.utils.emptyDomNode(e),window.requestAnimationFrame(t)}var f,g,m,b,p,h=s(t()),v=[],y=[];if(m=n.utils.domData.get(e,"binding"),h)if(r(h.dataClass,"string")){if(f=n.bindingProvider.instance.bindingRouter(h.dataClass,n.bindingProvider.instance.bindings),!f)throw new Error("Don't know how to render binding \""+h.dataClass+'" - no such binding registered. Either register the bindng or correct its name.');f&&(g=r(f,"function")?f.call(h.viewmodel||d,l):f)}else g=r(h,"function")?h.call(d,l):h;a(m,"transitions","outTransitions")&&(y=m.transitions.outTransitions.map(function(e){return c(e)})),a(g,"transitions","inTransitions")&&(v=g.transitions.inTransitions.map(function(e){return c(e)})),p=o.apply(null,y.concat(c(u)).concat(v)),b={getElement:function(){return e}},p.call(b),n.utils.domData.set(e,"binding",g)}var r=e.type.is,a=e.object.has,s=n.utils.unwrapObservable,o=e.functional.builders.continuation,c=e.functional.builder.$DO;return{init:t,update:i}}),define("scalejs.mvvm",["scalejs!core","knockout","scalejs.mvvm/mvvm","./scalejs.bindings/change","./scalejs.bindings/render"],function(e,n,t,i,r){n.bindingHandlers.change=i,n.bindingHandlers.render=r,n.virtualElements.allowedBindings.change=!0,n.virtualElements.allowedBindings.render=!0,t.init(),e.registerExtension(t)});