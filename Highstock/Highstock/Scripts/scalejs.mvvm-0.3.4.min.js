//knockout-classBindingProvider v0.4.0 | (c) 2012 Ryan Niemeyer | http://www.opensource.org/licenses/mit-license

define("scalejs.mvvm/classBindingProvider",["knockout"],function(e){return function(n){function t(e){var n,t;return d[e]?d[e]:(n=e.split("."),t=n.reduce(function(e,n){return e[n]},d))}function i(n){e.utils.extend(d,n)}function r(e){var t,i;return 1===e.nodeType?t=e.getAttribute(s):8===e.nodeType&&(i=(e.nodeValue||e.text||"").toString(),t=i.indexOf(c)>-1),!t&&n.fallback&&(t=l.nodeHasBindings(e)),t}function a(t,i){var r,a,d,u,f,g={},m="";1===t.nodeType?m=t.getAttribute(s):8===t.nodeType&&(u=(t.nodeValue||t.text||"").toString(),f=u.indexOf(c),f>-1&&(m=u.substring(f+c.length))),m?(m=m.replace(/^(\s|\u00A0)+|(\s|\u00A0)+$/g,"").replace(/(\s|\u00A0){2,}/g," ").split(" "),m.forEach(function(n){r=o(n),r&&(a="function"==typeof r?r.call(i.$data,i,m):r,e.utils.extend(g,a))})):n.fallback&&(g=l.getBindings(t,i));for(d in g)g.hasOwnProperty(d)&&"_ko_property_writers"!==d&&"valueUpdate"!==d&&!e.bindingHandlers[d]&&n.log&&(a?n.log('Unknown binding handler "'+d+'" found in',t,'defined in data-class "'+m+'" as',a,"Make sure that binding handler's name spelled correctly and that it's properly registered. The binding will be ignored."):n.log('Unknown binding handler "'+d+'" in',t,"Make sure that it's name spelled correctly and that it's properly registered. The binding will be ignored."));return g}var o,s,c,l=new e.bindingProvider,d={};return n=n||{},s=n.attribute||"data-class",c="ko "+(n.virtualAttribute||"class")+":",o=n.bindingRouter||t,{registerBindings:i,getBindings:a,nodeHasBindings:r,bindingRouter:o}}}),define("scalejs.mvvm/htmlTemplateSource",["knockout","scalejs!core"],function(e,n){function t(e){var n=document.createElement("div");n.innerHTML=e,r(n.childNodes).forEach(function(e){1===e.nodeType&&a(e,"id")&&(s[e.id]=e.innerHTML)})}function i(e){function n(n,t){return a(s.data,e)||(s.data[e]={}),1===arguments.length?s.data[e][n]:(s.data[e][n]=t,void 0)}function t(n){if(0===arguments.length)return s[e];throw new Error('An attempt to override template "'+e+'" with content "'+n+'" '+"Template overriding is not supported.")}return{data:n,text:t}}var r=n.array.toArray,a=n.object.has,o=new e.nativeTemplateEngine,s={data:{}};return o.makeTemplateSource=i,e.setTemplateEngine(o),{registerTemplates:t}}),define("scalejs.mvvm/selectableArray",["knockout","scalejs!core"],function(e,n){var t=e.isObservable,i=e.utils.unwrapObservable,r=e.observable,a=e.computed,o=n.object.has,s=n.array;return function(e,n){function c(e){if(!t(e.isSelected)||o(n.isSelectedPath)&&"isSelected"!==n.isSelectedPath){if(t(e.isSelected))throw new Error('item has observable `isSelected` property but `isSelectedPath` specified as "'+n.isSelectedPath+'". `selectable` uses `isSelected` property of an item '+"to determine whether it's selected. Either don't specify `isSelectedPath` or "+"rename `isSelected` property to something else.");if(e.hasOwnProperty("isSelected"))throw new Error("item has non-observable `isSelected` property. `selectable` uses `isSelected` property of an item to determine whether it's selected. Either make `isSelected` observable or rename it.");if(e.isSelected=r(),o(n.isSelectedPath)&&"isSelected"!==n.isSelectedPath&&!t(e[n.isSelectedPath]))throw new Error("item's property \""+n.isSelectedPath+'" specified by `isSelectedPath` '+" isn't observable. Either make it observable or specify different property in "+" `isSelectedPath`");o(n.isSelectedPath)&&(e.isSelected=e[n.isSelectedPath]),e.isSelected.subscribe(function(n){n?d(e):d()===e&&d(void 0)})}}n=n||{};var l,d=n.selectedItem||r(),u=n.selectionPolicy||"single";return t(e)?l=a(function(){var n=i(e);return n.forEach(c),s.copy(n)}):(e.forEach(c),l=s.copy(e)),d.subscribe(function(e){i(l).forEach(function(n){n.isSelected(n===e)}),"deselect"===u&&e&&setTimeout(function(){d(void 0)},0)}),l.selectedItem=d,l}}),define("scalejs.mvvm/ko.utils",["scalejs!core","knockout"],function(e,n){function t(t,i){return e.array.toArray(t).map(function(e){var t=e.cloneNode(!0);return i?n.cleanNode(t):t})}return{cloneNodes:t}}),define("scalejs.mvvm/mvvm",["knockout","knockout.mapping","scalejs!core","./classBindingProvider","./htmlTemplateSource","./selectableArray","./ko.utils","module"],function(e,n,t,i,r,a,o,s){function c(n){return e.observable(n)}function l(n){return e.observableArray(n)}function d(n){return e.computed(n)}function u(e){return n.toJSON(e)}function f(e){return JSON.parse(u(e))}function g(){w(arguments).forEach(S.registerBindings)}function m(e,t,i){var r=Object.keys(i).reduce(function(e,n){return k(e,{k:n,create:function(e){return i[n](e.data)}})},{});return n.fromJS(e,r,t)}function p(){w(arguments).forEach(r.registerTemplates)}function b(e,n){var t={};return t[e]=n,t}function v(e,n){return b("template",{name:e,data:n})}function h(e,n){return{dataClass:e,viewmodel:n}}function y(){var n=document.getElementsByTagName("body")[0];n.innerHTML="<!-- ko class: scalejs-shell --><!-- /ko -->",g({"scalejs-shell":function(e){return{render:e.$data.root}}}),e.applyBindings({root:j})}var k=t.object.merge,w=t.array.toArray,S=i({log:s.config().logWarnings?t.log.warn:void 0,fallback:!0}),j=e.observable();return e.bindingProvider.instance=S,{core:{mvvm:{toJson:u,registerBindings:g,registerTemplates:p,dataClass:h,template:v,dataBinding:b,selectableArray:a,ko:{utils:o}}},sandbox:{mvvm:{observable:c,observableArray:l,computed:d,registerBindings:g,registerTemplates:p,toJson:u,toViewModel:m,toObject:f,dataClass:h,template:v,dataBinding:b,selectableArray:a,root:j}},init:y}}),define("scalejs.bindings/change",["knockout","scalejs!core"],function(e,n){function t(n,t,a,o){function s(e,t){return function(i){i!==t&&(t=i,e.call(o,i,n))}}function c(t,i){e.computed({read:function(){var e=f(o[t]);i(e)},disposeWhenNodeIsRemoved:n})}if(r(o)){var l,d,u,f=e.utils.unwrapObservable,g=t(),m=f(g);for(l in m)m.hasOwnProperty(l)&&(d=m[l],i(d.initial,"function")&&d.initial.apply(o,[f(o[l]),n]),i(d.update,"function")&&(u=s(d.update,f(o[l]))),i(d,"function")&&(u=s(d,f(o[l]))),u&&c(l,u))}}var i=n.type.is,r=n.object.has;return{init:t}}),define("scalejs.bindings/render",["scalejs!core","knockout","scalejs.functional"],function(e,n){function t(){return{controlsDescendantBindings:!0}}function i(e,t,i,l,d){function u(t){g?n.applyBindingsToNode(e,g,l):n.utils.emptyDomNode(e),window.requestAnimationFrame(t)}var f,g,m,p,b,v=o(t()),h=[],y=[];if(m=n.utils.domData.get(e,"binding"),v)if(r(v.dataClass,"string")){if(f=n.bindingProvider.instance.bindingRouter(v.dataClass),!f)throw new Error("Don't know how to render binding \""+v.dataClass+'" - no such binding registered. '+"Either register the bindng or correct its name.");f&&(g=r(f,"function")?f.call(v.viewmodel||l,d):f)}else g=r(v,"function")?v.call(l,d):v;a(m,"transitions","outTransitions")&&(y=m.transitions.outTransitions.map(function(e){return c(e)})),a(g,"transitions","inTransitions")&&(h=g.transitions.inTransitions.map(function(e){return c(e)})),b=s.apply(null,y.concat(c(u)).concat(h)),p={getElement:function(){return e}},b.call(p),n.utils.domData.set(e,"binding",g)}var r=e.type.is,a=e.object.has,o=n.utils.unwrapObservable,s=e.functional.builders.complete,c=e.functional.builder.$DO;return{init:t,update:i}}),define("scalejs.mvvm",["scalejs!core","knockout","scalejs.mvvm/mvvm","./scalejs.bindings/change","./scalejs.bindings/render"],function(e,n,t,i,r){n.bindingHandlers.change=i,n.bindingHandlers.render=r,n.virtualElements.allowedBindings.change=!0,n.virtualElements.allowedBindings.render=!0,t.init(),e.registerExtension(t)});