/*! 
 * jquery.event.drag - v 2.2
 * Copyright (c) 2010 Three Dub Media - http://threedubmedia.com
 * Open Source MIT License - http://threedubmedia.com/code/license
 */
(function(n){var s="dragstart",c="mousemove mouseup",h="touchmove touchend",y="ondragstart",v="touchstart mousedown",e=!0,r=!1,o="drag",f=null,a,l;n.fn.drag=function(t,i,r){var u=typeof t=="string"?t:"",e=n.isFunction(t)?t:n.isFunction(i)?i:f;return u.indexOf(o)!==0&&(u=o+u),r=(t==e?i:r)||{},e?this.bind(u,r,e):this.trigger(u)};var i=n.event,u=i.special,t=u.drag={defaults:{which:1,distance:0,not:":input",handle:f,relative:r,drop:e,click:r},datakey:"dragdata",noBubble:e,add:function(i){var u=n.data(this,t.datakey),r=i.data||{};u.related+=1,n.each(t.defaults,function(n){r[n]!==undefined&&(u[n]=r[n])})},remove:function(){n.data(this,t.datakey).related-=1},setup:function(){var r=this;if(!n.data(r,t.datakey)){var u=n.extend({related:0},t.defaults);n.data(r,t.datakey,u),i.add(r,v,t.init,u),r.attachEvent&&r.attachEvent(y,t.dontstart)}},teardown:function(){var r=this,u=n.data(r,t.datakey)||{};u.related||(n.removeData(r,t.datakey),i.remove(r,v,t.init),t.textselect(e),r.detachEvent&&r.detachEvent(y,t.dontstart))},init:function(e){if(!t.touched){var o=e.data,s;if(e.which==0||!(o.which>0)||e.which==o.which)return n(e.target).is(o.not)?void 0:o.handle&&!n(e.target).closest(o.handle,e.currentTarget).length?void 0:(t.touched=e.type=="touchstart"?this:f,o.propagates=1,o.mousedown=this,o.interactions=[t.interaction(this,o)],o.target=e.target,o.pageX=e.pageX,o.pageY=e.pageY,o.dragging=f,s=t.hijack(e,"draginit",o),!o.propagates)?void 0:(s=t.flatten(s),s&&s.length&&(o.interactions=[],n.each(s,function(){o.interactions.push(t.interaction(this,o))})),o.propagates=o.interactions.length,o.drop!==r&&u.drop&&u.drop.handler(e,o),t.textselect(r),t.touched?i.add(t.touched,h,t.handler,o):i.add(document,c,t.handler,o),!t.touched||o.live?r:void 0)}},interaction:function(i,r){var u=n(i)[r.relative?"position":"offset"]()||{top:0,left:0};return{drag:i,callback:new t.callback,droppable:[],offset:u}},handler:function(f){var a="mousemove",v="touchmove",l=f.data;switch(f.type){case!l.dragging&&v:f.preventDefault();case!l.dragging&&a:if(Math.pow(f.pageX-l.pageX,2)+Math.pow(f.pageY-l.pageY,2)<Math.pow(l.distance,2))break;f.target=l.target,t.hijack(f,s,l),l.propagates&&(l.dragging=e);case v:f.preventDefault();case a:if(l.dragging){if(t.hijack(f,o,l),l.propagates){l.drop!==r&&u.drop&&u.drop.handler(f,l);break}f.type="mouseup"}case"touchend":case"mouseup":default:t.touched?i.remove(t.touched,h,t.handler):i.remove(document,c,t.handler),l.dragging&&(l.drop!==r&&u.drop&&u.drop.handler(f,l),t.hijack(f,"dragend",l)),t.textselect(e),l.click===r&&l.dragging&&n.data(l.mousedown,"suppress.click",+new Date+5),l.dragging=t.touched=r}},hijack:function(u,h,c,l,a){var w="dropinit",b="drop";if(c){var g={event:u.originalEvent,type:u.type},k=h.indexOf(b)?o:b,y,d=l||0,v,tt,p,nt=isNaN(l)?c.interactions.length:l;u.type=h,u.originalEvent=f,c.results=[];do if(v=c.interactions[d]){if(h!=="dragend"&&v.cancelled)continue;p=t.properties(u,c,v),v.results=[],n(a||v[k]||c.droppable).each(function(l,a){return p.target=a,u.isPropagationStopped=function(){return r},y=a?i.dispatch.call(a,u,p):f,y===r?(k==o&&(v.cancelled=e,c.propagates-=1),h==b&&(v[k][l]=f)):h==w&&v.droppable.push(t.element(y)||a),h==s&&(v.proxy=n(t.element(y)||v.drag)[0]),v.results.push(y),delete u.result,h!==w?y:void 0}),c.results[d]=t.flatten(v.results),h==w&&(v.droppable=t.flatten(v.droppable)),h!=s||v.cancelled||p.update()}while(++d<nt);return u.type=g.type,u.originalEvent=g.event,t.flatten(c.results)}},properties:function(n,i,r){var u=r.callback;return u.drag=r.drag,u.proxy=r.proxy||r.drag,u.startX=i.pageX,u.startY=i.pageY,u.deltaX=n.pageX-i.pageX,u.deltaY=n.pageY-i.pageY,u.originalX=r.offset.left,u.originalY=r.offset.top,u.offsetX=u.originalX+u.deltaX,u.offsetY=u.originalY+u.deltaY,u.drop=t.flatten((r.drop||[]).slice()),u.available=t.flatten((r.droppable||[]).slice()),u},element:function(n){if(n&&(n.jquery||n.nodeType==1))return n},flatten:function(i){return n.map(i,function(i){return i&&i.jquery?n.makeArray(i):i&&i.length?t.flatten(i):i})},textselect:function(i){n(document)[i?"unbind":"bind"]("selectstart",t.dontstart).css("MozUserSelect",i?"":"none"),document.unselectable=i?"off":"on"},dontstart:function(){return r},callback:function(){}};t.callback.prototype={update:function(){u.drop&&this.available.length&&n.each(this.available,function(n){u.drop.locate(this,n)})}},a=i.dispatch,i.dispatch=function(t){var i="suppress.";if(n.data(this,i+t.type)-+new Date>0){n.removeData(this,i+t.type);return}return a.apply(this,arguments)},l=i.fixHooks.touchstart=i.fixHooks.touchmove=i.fixHooks.touchend=i.fixHooks.touchcancel={props:"clientX clientY pageX pageY screenX screenY".split(" "),filter:function(t,i){if(i){var r=i.touches&&i.touches[0]||i.changedTouches&&i.changedTouches[0]||f;r&&n.each(l.props,function(n,i){t[i]=r[i]})}return t}},u.draginit=u.dragstart=u.dragend=t})(jQuery);