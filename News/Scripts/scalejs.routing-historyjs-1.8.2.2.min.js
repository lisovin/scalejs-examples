define("scalejs.routing-historyjs/history",["scalejs!core","history","scalejs.reactive"],function(t,e){function r(t){return e.pushState(t.data,t.title,t.url)}function a(){return e.getState()}function n(t){return e.replaceState(t.data,t.title,t.url)}function s(){var r=t.reactive.Observable,n=t.reactive.Disposable;return r.createWithDisposable(function(t){e.Adapter.bind(window,"statechange",function(){t.onNext(a())});return n.create(function(){window.onstatechange=null})}).publishValue(a()).refCount()}return{add:r,get:a,replace:n,observe:s}}),define("scalejs.routing-historyjs/routing",["scalejs!core","./history","scalejs.statechart-scion","scalejs.reactive"],function(t,e){function r(){return e.observe().select(i)}function a(t){return"/"===t||"?"===t||""===t}function n(t){var e="?"+t.path.join("/");return d(t.parameters)&&(e+="?"+Object.keys(t.parameters).map(function(e){return e+"="+t.parameters[e]}).join("&")),e}function s(t){var e=a(t)?[[""]]:t.split("?").filter(function(t){return""!==t}).map(function(t,e){return 0===e?t.split("/"):t.split("&")});return{path:e[0],parameters:d(e[1])?e[1].reduce(function(t,e){var r=e.split("=");return t[r[0]]=r[1],t},{}):void 0}}function i(t){var e=t.hash.replace(p,""),r=s(e);return h(r,{url:n(r),timestamp:(new Date).getTime()})}function u(t){return f(t,"string")?t.replace("{","").replace("}",""):t}function o(t){var e=s(t);return w(function(t){D[t.id]=e,S.push(g("routed",function(t){return t.data.path[0]===e.path[0]?(e.path.slice(1).forEach(function(e,r){t.data[u(e)]=t.data.path[r+1]}),t.data=h(t.data,t.data.parameters),!0):!1},m(t.id)))})}function c(t){O?(O=!1,e.replace({url:n(t)})):e.add({url:n(t)})}function l(e,a){function n(){function t(t){return t===e}var e;o.add(E().subscribe(function(t){var e;d(D,t.state)&&"entry"===t.event&&(e=D[t.state],e.path=e.path.map(function(e){var r=e.match(/[^{}]+(?=\})/);return d(r)?t.currentEvent.data[r[0]]:e}),d(e.parameters)&&Object.keys(e.parameters).forEach(function(r){e.parameters[r]=t.currentEvent.data[u(e.parameters[r])]}),c(e))})),o.add(r().subscribe(function(r){t(r.url)||(e=r.url,y("routed",{path:r.path,parameters:r.parameters},0))}))}var s,i,o=new t.reactive.CompositeDisposable;return d(a,"baseUrl")?(p=a.baseUrl,i=b(arguments).slice(2,arguments.length)):i=b(arguments).slice(1,arguments.length),s=j.apply(null,[e,g("router.disposing",m("router.disposed")),j("router.waiting",v(n)),j("router.disposed",v(function(){o.dispose(),D={},S=[]}))].concat(S).concat(i))}var p,d=t.object.has,f=t.type.is,h=t.object.merge,b=t.array.toArray,g=t.state.builder.on,m=t.state.builder.gotoInternally,v=t.state.builder.onEntry,j=t.state.builder.state,y=t.state.raise,w=t.functional.builder.$yield,E=t.state.observe,D={},S=[],O=!0;return{route:o,routerState:l}}),define("scalejs.routing-historyjs",["scalejs!core","./scalejs.routing-historyjs/routing"],function(t,e){t.registerExtension({routing:e})});